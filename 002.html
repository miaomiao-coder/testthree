<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>My first three.js app</title>
    <style>
        body {
            margin: 0;
        }
    </style>
</head>

<body>
    <script src="./dat/dat.gui.js"></script>
    <script type="module">
        import * as THREE from './three.js/Three.js';
        // Our Javascript will go here.
        //创建场景
        var scene = new THREE.Scene();
        //fog设置场景雾化效果
        // scene.fog=new THREE.Fog(0xff0000,0.03,100)
        // scene.fog=new THREE.FogExp2(0xffffff,0.02)
        // overrideMaterial设置场景使用相同材质
        // scene.overrideMaterial=new THREE.MeshLambertMaterial({color:0xff00ff})
        //透视摄像头
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        //渲染器
        const renderer = new THREE.WebGLRenderer();
        //设置渲染器大小
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true
        //将渲染器作为body的子节点
        document.body.appendChild(renderer.domElement);

        //创建几何体
        var boxGeometry = new THREE.BoxGeometry(10, 10, 10);
        //创建材质
        var boxMaterial = new THREE.MeshLambertMaterial({ color: 0xffff00 });
        //创建网格
        var cube = new THREE.Mesh(boxGeometry, boxMaterial);

        //设置几何体的位置
        cube.position.x = 5;
        cube.position.y = 5;
        cube.position.z = 5;
        //Lambert材质且castShadow=true，几何体上的光影才起效果
        cube.castShadow = true;

        //将网格加入场景
        scene.add(cube);
        //x、y轴旋转角度
        // cube.rotation.x = 0.5;
        // cube.rotation.y = 0.5;

        //region
        //创建几何体
        var boxGeometry1 = new THREE.BoxGeometry(10, 10, 10);
        //创建材质
        var boxMaterial1 = new THREE.MeshLambertMaterial({ color: 0x00ff00 });
        //创建网格
        var cube1 = new THREE.Mesh(boxGeometry1, boxMaterial1);
        cube1.name="cub2"

        //设置几何体的位置
        cube1.position.x = -10;
        cube1.position.y = 5;
        cube1.position.z =0;
        //Lambert材质且castShadow=true，几何体上的光影才起效果
        cube1.castShadow = true;
        //将网格加入场景
        scene.add(cube1);
        //根据名称获取场景里的对象
        var findObj=scene.getObjectByName("cub2",false)
        console.log(findObj.position)
        var removeObj=new function (){
             this.removeAction=function(){
                if(findObj instanceof THREE.Mesh)
                {
                    scene.remove(findObj);
                }
            }

        }
        var ctrl1 = new dat.GUI();
        //将定义的对象传给dat.gui,0，1为取值范围，不传则显示输入框
        //详细设置可参考https://blog.csdn.net/weixin_46941477/article/details/115551149
        ctrl1.add(removeObj, "removeAction");
        //endregion

        //三维坐标轴
        var axes = new THREE.AxesHelper(50);
        //设置x、y、z轴线颜色
        // axes.setColor();
        scene.add(axes);

        //设置摄像头z坐标位置（离屏幕的垂直距离），越大离的越远
        // camera.position.z = 8;
        // camera.position.set(0, 0, 100);

        camera.position.x = -30
        camera.position.y = 45;
        camera.position.z = 35;
        //将摄像机的方向对准场景的中心点，
        camera.lookAt(scene.position);


        //创建平面几何体（地面）
        var planeGe = new THREE.PlaneGeometry(100, 100);
        var planeMe = new THREE.MeshLambertMaterial({ color: 0xcccccc });
        var plane = new THREE.Mesh(planeGe, planeMe);
        //Math.PI=180°
        plane.rotation.x = -0.5 * Math.PI;
        //平面接收光影
        plane.receiveShadow = true;
        scene.add(plane);
        //Lambert材质必须通过AmbientLight才能显示
        var ambientLight = new THREE.AmbientLight(0xAAAAAA)
        scene.add(ambientLight);

        var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.castShadow = true;
        spotLight.position.set(-40, 30, -30);
        //设置阴影效果
        spotLight.shadow.mapSize = new THREE.Vector2(1024, 1024);
        spotLight.shadow.camera.far = 120;
        spotLight.shadow.camera.near = 40;
        scene.add(spotLight);

        //渲染
        // renderer.render(scene, camera);

        //定义一个对象存放旋转/跳跃速度
        var ctrlObj = { rotationSpeed: 0.05, jumpSpeed: 0.01 }
        var ctrl = new dat.GUI();
        //将定义的对象传给dat.gui,0，1为取值范围，不传则显示输入框
        //详细设置可参考https://blog.csdn.net/weixin_46941477/article/details/115551149
        ctrl.add(ctrlObj, "rotationSpeed", 0, 1);
        ctrl.add(ctrlObj, "jumpSpeed", 0, 1);
        renderAnimation();
        var gap = 0;
        function renderAnimation() {
            //旋转
            // cube.rotation.x+=0.05;
            // cube.rotation.y+=0.05;
            // cube.rotation.x += ctrlObj.rotationSpeed;
            // cube.rotation.y += ctrlObj.rotationSpeed;

            //traverse遍历出所有对象
            scene.traverse(function(obj){
                if(obj instanceof THREE.Mesh&&obj!=plane)
                {
                    obj.rotation.x += ctrlObj.rotationSpeed;
                    obj.rotation.y += ctrlObj.rotationSpeed;
                }
            })

            //跳跃速度
            // gap+=0.01
            gap += ctrlObj.jumpSpeed
            cube.position.x = 25 + (20 * (Math.sin(gap)));
            cube.position.y = 6 + (20 * Math.abs(Math.cos(gap)));
            requestAnimationFrame(renderAnimation);
            //渲染
            renderer.render(scene, camera);
        }
        //实现场景自适应功能：1.监听浏览器热死则时间，并通过回调重写事件 2。回调中重新设置camera的aspect属性，设置渲染的长宽比
        window.addEventListener("resize", onWIndowResize, false);
        function onWIndowResize()
        {
            camera.aspect=window.innerWidth/window.innerHeight
            //手动更新相机的投影矩阵
            camera.updateProjectionMatrix();
            //重置场景的渲染尺寸
            camera.setSize(window.innerWidth,window.innerHeight);
        }
    </script>
</body>

</html>